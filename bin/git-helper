#!/bin/bash
echo "Cleaning up build and .svelte-kit folder"
rm -r build .svelte-kit

if npm ci
then
    echo "Performed node modules clean install"
else
    echo "Could not install dependencies"
    exit 1
fi

if npm run sync-types
then
    echo "Star charts aligned"
else
    echo "Could not sync types?!"
    exit 1
fi

# We want to not use the cache here, hoping that we really catch all the bugz
if npm run check:nocache
then
    echo "All good"
else
    echo "This could've been a 5-star review, but..."
    # 360 nocache
    npm run fix:nocache
    exit 1
fi

echo "Running build"
if npm run build
then
    echo "Build worked"
else
    exit 1
fi

echo "Splines reticulated"
echo "Have a nice day"
